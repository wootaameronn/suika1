<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ストリートライドでTextAlive</title>
  <script src="https://unpkg.com/textalive-app-api/dist/index.js"></script>
</head>
<body>
  <div id="log" style="color:lime; font-size:24px;">クリックで開始</div>
  <audio id="media" controls></audio>

  <script>
    // 単語が発音されたら表示する関数
    const animateWord = (now, unit) => {
      if (unit.contains(now)) {
        document.getElementById("log").textContent = unit.text;
      }
    };

    // TextAlive Player を作成
    const player = new TextAliveApp.Player({
      app: {
        token: "your_token_here",  // ← 自分のトークンに書き換えてね
        name: "ストリートライドテスト"
      },
      mediaElement: document.querySelector("#media"),
      mediaBannerPosition: "bottom right"
    });

    let readyToPlay = false;

    player.addListener({
      onAppReady: (app) => {
        if (!app.managed) {
          // ストリートライト / 加賀(ネギシャワーP)
           player.createFromSongUrl("https://piapro.jp/t/ULcJ/20250205120202", {
            video: {
              // 音楽地図訂正履歴
              beatId: 4694275,
              chordId: 2830730,
              repetitiveSegmentId: 2946478,
      
              // 歌詞URL: https://piapro.jp/t/DPXV
              // 歌詞タイミング訂正履歴: https://textalive.jp/lyrics/piapro.jp%2Ft%2FULcJ%2F20250205120202
              lyricId: 67810,
              lyricDiffId: 20654
            },
          });

      onVideoReady: () => {
        let word = player.video.firstWord;
        while (word) {
          word.animate = animateWord;
          word = word.next;
        }
        readyToPlay = true;
      },

      onPlay: () => {
        document.getElementById("log").textContent = "再生開始！";
      }
    });

    document.addEventListener("click", () => {
      console.log("クリックされました！");
      if (readyToPlay) {
        player.requestPlay();
      } else {
        alert("準備がまだ完了していません…");
      }
    });
  </script>
</body>
</html>